
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>対話で学ぶメルセンヌツイスタ</title>
<meta name="viewport" content="width=device-width">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
  TeX: {
    Macros: {
      floor: ['{\\lfloor #1 \\rfloor}', 1],
    }
  }
});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>
var MAP = {"ルイス": "lewis", "マスター": "master"};
function text(s) { return document.createTextNode(s); }
$(function () {
	var str = $("script[type='text/x-serif']").text();
	str.split("\n").forEach(function (line) {
		if (line == "") return;
		line = line.replace("」", "」<br>");
		if (!/「/.test(line)) {
			$("#out").append(line);
		} else {
			var m = line.match(/^([^「]+)(.*)/);
			var name = m[1];
			var serif = m[2];
			$("#out").append("<img src='"+MAP[name]+".png'>").append(serif);
		}
	});
});
</script>
</head>
<body>
<script type="text/x-serif">
ルイスは某大学工学部情報科に通う大学生。今日は用事があって親しいバーのマスターの元へやってきた。<br>

ルイス「よぁ、おやっさん」
マスター「ん、ルイスじゃないか。どうした」

<!-- この辺にもう少し日常会話がほしい -->

ルイス「あぁ実は聞きたいことがあって。おやっさんメルセンヌツイスタって知っているか？」
マスター「あぁ知っているさ。有名な疑似乱数だろ？それがどうした」
ルイス「メルセンヌツイスタがどんな仕組みなのか知りたいんだ。メルセンヌツイスタの周期って$2^{19937}-1$で、これってメルセンヌ素数だろ？メルセンヌ素数がどう関係しているのか知りたいんだ」
マスター「ああ、なるほど。教えてやってもいいんだが…ルイス、お前、代数学は分かるのか？」
ルイス「ん～代数学か。ちゃんと勉強したことはないな」
マスター「そうか…」
ルイス「あぁでも、群・環・体の定義なら数学ガールという本で読んだことがある」
マスター「なるほど、じゃあイデアルって分かるか？」
ルイス「それは知らないな…」
マスター「う～ん、そうか。でもお前大学で線形代数はちゃんと勉強したんだろ？線形代数がわかって群・環・体の定義を知っているならまあなんとか分かるように教えられるかもしれん」
ルイス「ほんとか！？」
マスター「まあ、期待はするなよ」
<hr>
マスター「で、メルセンヌツイスタなんだが…。実はこれを理解するためにメルセンヌツイスタだけに焦点を当てても本質は見えてこない。もっと一般的に遷移関数が有限体上の線形空間の線形写像である有限オートマトンを考えた方がいい」
ルイス「どういうことだ？」
マスター「つまり、$d$次正方行列$A$を用いて現在の状態$\mathbf{x}_n$から次の状態$\mathbf{x}_{n+1}$が
$$\mathbf{x}_{n+1} = A \mathbf{x}_{n}$$
で得られるものだ。$\mathbf{x}_{n}$は$d$次元の縦ベクトルな」
ルイス「んんんん…っと。つまり、乱数を一つ生成するたびに現在の状態に行列$A$をかけるってことか。えっ、メルセンヌツイスタもこういうものなのか？」
マスター「ああそうだ。メルセンヌツイスタの場合は$A$が$19937$次の行列だな」
ルイス「ええっ。いやいや乱数を一つ生成するたびに$19937$次の行列なんて掛けていたら遅すぎて使いものにならないでしょう！？」
マスター「もちろん馬鹿正直に行列とベクトルの積を計算しているわけじゃない。行列$A$はコンピュータで簡単に計算できるものを選んでいるのさ」
ルイス「ふうん…」
マスター「あと、これら行列やベクトルの成分は実数ではない。$\mathbb{F}_2$の元だ」
ルイス「$\mathbb{F}_2$？なんだそれは」
マスター「集合$\{0, 1\}$に足し算と掛け算を定義してできる体だ。$1 + 1 = 0$であることだけが普通の数の演算と違う。」
ルイス「ああ、わかった。$\mathbb{Z}/2\mathbb{Z}$のことか。数学ガールで出てきたよ」
マスター「なんだ知っていたのか」
<hr>
マスター「と、ここで考えてほしい。メルセンヌツイスタの状態は体$\mathbb{F}_2$上の$19937$次元ベクトルだ。このベクトル全体がなす空間はいったいいくつの要素からなる？」
ルイス「ええと$\mathbb{F}_2$が要素数$2$なんだから…$2$の$19937$乗か。あれっこれってメルセンヌツイスタの周期？いやでも周期は$2^{19937}-1$だから$1$だけ違う？」
マスター「状態が$0$だと行列$A$を何回かけようが$0$だろう。だからメルセンヌツイスタは状態に$0$をとらないようにしている。$0$以外の元を初期状態に選んだとき、$0$以外のすべての状態を通って、$2^{19937}-1$回目に最初の状態に戻ってくる。」
マスター「図に書くとこんな感じだな。$2^{19937}$個は多すぎて書けないから$0$を含めて$8$個にした。」
<img src="mt-state-action.png"><br>
ルイス「あ、なるほど！この一つの丸が一つの状態を表しているのか。この図は$7$個の丸が並んでいるけどメルセンヌツイスタだったら$2^{19937}-1$個並んでいるってことか」
マスター「そういうことだ」
マスター「こんな風に$0$以外のすべての状態が一つの軌道に連なってくれると嬉しいわけだな。初期状態が$0$にならないようにだけ気を付ければどんな初期状態から始めても必ず周期が$(\text{全状態数})-1$になるわけだから」
ルイス「ふむ」
マスター「これを周期が最長になるって呼ぶことにしよう」
<hr>
マスター「じゃ、ここらで具体的な線形漸化式で周期を計算してみるか。次の問題を解いてみろ。」
$$
\mathbf{x} \mapsto A \mathbf{x},\;A = \begin{bmatrix}1 &0 &1 \\ 1 &1 &1 \\ 1 &0 &0\end{bmatrix}
$$
で決まる$\mathbb{F}_2^3$の変換による軌道を決定せよ。<br>
ルイス「軌道を決定…？」
マスター「$\mathbb{F}_2^3$のすべての元が、$A$をかけるという作用でどのように行き来するか決定すればいい」
ルイス「分かりました」

ルイス「じゃあ$[1,0,0]$から始めてみます」
$[1,0,0] \to [1,1,1] \to [0,1,1] \to [1,0,0]$


 
</script>
<div id="out"></div>
<h2>参考文献</h2>
<p>[1] 松本眞 (2004) “<a href="http://www.math.sci.hiroshima-u.ac.jp/~m-mat/TEACH/0407-2.pdf">有限体の擬似乱数への応用</a>”
<h2>あとがき</h2>
<p>何か間違いがあればご報告ください。
<p>キャラクターの画像は「WOLF RPGエディター」の「グラフィック合成器」によって生成しました。

</body>
</html>